<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rlenvscpp: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">rlenvscpp
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://github.com/pockerman/rlenvs_from_cpp/actions/workflows/build.yml"><img src="https://github.com/pockerman/rlenvs_from_cpp/actions/workflows/build.yml/badge.svg" alt="Build rlenvs" style="pointer-events: none;" class="inline"/></a> </p>
<h1><a class="anchor" id="autotoc_md0"></a>
rlenvscpp</h1>
<div class="fragment"><div class="line"> {rlenvscpp```}</div>
<div class="line">using  C++. In addition, the library provides various utilities such as experiment tracking,</div>
<div class="line">representing trajectories  via waypoints and simple implementation of popular dynamics such as </div>
<div class="line">quadrotor dynamics.</div>
<div class="line"> </div>
<div class="line">## Environments</div>
<div class="line"> </div>
<div class="line">Currently, ```rlenvscpp``` provides the following environments:</div>
<div class="line"> </div>
<div class="line">| Environment         |   Use REST   | Example                                                   |</div>
<div class="line">| :----------------   | :----------: | :----:                                                    |</div>
<div class="line">| FrozenLake 4x4 map  |   Yes        | &lt;a href=&quot;examples/example_1/example_1.cpp&quot;&gt;example_1&lt;/a&gt;  |</div>
<div class="line">| FrozenLake 8x8 map  |   Yes        | TODO                                                      |</div>
<div class="line">| Blackjack           |   Yes        | &lt;a href=&quot;examples/example_1/example_1.cpp&quot;&gt;example_1&lt;/a&gt;  |</div>
<div class="line">| CliffWalking        |   Yes        | &lt;a href=&quot;examples/example_1/example_1.cpp&quot;&gt;example_1&lt;/a&gt;  |</div>
<div class="line">| CartPole            |   Yes        | TODO                                                      |</div>
<div class="line">| MountainCar         |   Yes        | TODO                                                      |</div>
<div class="line">| Taxi                |   Yes        | &lt;a href=&quot;examples/example_1/example_1.cpp&quot;&gt;example_1&lt;/a&gt;  |</div>
<div class="line">| Pendulum            |   Yes        | &lt;a href=&quot;examples/example_6/example_6.cpp&quot;&gt;example_6&lt;/a&gt;  |</div>
<div class="line">| Acrobot             |   Yes        | TODO                                                      |</div>
<div class="line">| GymWalk             |   Yes        | TODO                                                      |</div>
<div class="line">| gym-pybullet-drones |  TODO        | TODO                                                      |</div>
<div class="line">| GridWorld           |   No         | &lt;a href=&quot;examples/example_5/example_5.cpp&quot;&gt;example_5&lt;/a&gt;  |</div>
<div class="line">| Connect2            |   No         | &lt;a href=&quot;examples/example_7/example_7.cpp&quot;&gt;example_7&lt;/a&gt;  |</div>
<div class="line"> </div>
<div class="line">The Gymnasium (former OpenAI-Gym) environments utilise a REST API to communicate requests to/from the </div>
<div class="line">environment and ```rlenvscpp```.</div>
<div class="line"> </div>
<div class="line">Some environments have a vector implementation meaning multiple instances of the same</div>
<div class="line">environment. Currently, ```rlenvscpp``` provides the following vector environments: </div>
<div class="line"> </div>
<div class="line">| Environment         |   Use REST   | Example                                                    |</div>
<div class="line">| :----------------   | :----------: | :----:                                                     |</div>
<div class="line">| AcrobotV            |   Yes        |  &lt;a href=&quot;examples/example_8/example_8.cpp&quot;&gt;example_8&lt;/a&gt;  |</div>
<div class="line"> </div>
<div class="line">Various RL algorithms using the environments can be found at &lt;a href=&quot;https://github.com/pockerman/cuberl/tree/master&quot;&gt;cuberl&lt;/a&gt;.</div>
<div class="line"> </div>
<div class="line">### How to use</div>
<div class="line"> </div>
<div class="line">The following is an example how to use the </div>
<div class="line">```FrozenLake```   environment from &lt;a href=&quot;https://github.com/Farama-Foundation/Gymnasium/tree/main&quot;&gt;Gymnasium&lt;/a&gt;.</div>
<div class="line"> </div>
<div class="line">```cpp</div>
<div class="line">#include &quot;rlenvs/rlenvs_types_v2.h&quot;</div>
<div class="line">#include &quot;rlenvs/envs/gymnasium/toy_text/frozen_lake_env.h&quot;</div>
<div class="line">#include &quot;rlenvs/envs/api_server/apiserver.h&quot;</div>
<div class="line"> </div>
<div class="line">#include &lt;iostream&gt;</div>
<div class="line">#include &lt;string&gt;</div>
<div class="line">#include &lt;unordered_map&gt;</div>
<div class="line">#include &lt;any&gt;</div>
<div class="line"> </div>
<div class="line">namespace example_1{</div>
<div class="line"> </div>
<div class="line">const std::string SERVER_URL = &quot;http://0.0.0.0:8001/api&quot;;</div>
<div class="line"> </div>
<div class="line">using rlenvscpp::envs::gymnasium::FrozenLake;</div>
<div class="line">using rlenvscpp::envs::RESTApiServerWrapper;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">void test_frozen_lake(const RESTApiServerWrapper&amp; server){</div>
<div class="line"> </div>
<div class="line">    FrozenLake&lt;4&gt; env(server);</div>
<div class="line"> </div>
<div class="line">    std::cout&lt;&lt;&quot;Environame URL: &quot;&lt;&lt;env.get_url()&lt;&lt;std::endl;</div>
<div class="line"> </div>
<div class="line">    // make the environment</div>
<div class="line">    std::unordered_map&lt;std::string, std::any&gt; options;</div>
<div class="line">    options.insert({&quot;is_slippery&quot;, false});</div>
<div class="line">    env.make(&quot;v1&quot;, options);</div>
<div class="line"> </div>
<div class="line">    std::cout&lt;&lt;&quot;Is environment created? &quot;&lt;&lt;env.is_created()&lt;&lt;std::endl;</div>
<div class="line">    std::cout&lt;&lt;&quot;Is environment alive? &quot;&lt;&lt;env.is_alive()&lt;&lt;std::endl;</div>
<div class="line">    std::cout&lt;&lt;&quot;Number of valid actions? &quot;&lt;&lt;env.n_actions()&lt;&lt;std::endl;</div>
<div class="line">    std::cout&lt;&lt;&quot;Number of states? &quot;&lt;&lt;env.n_states()&lt;&lt;std::endl;</div>
<div class="line"> </div>
<div class="line">    // reset the environment</div>
<div class="line">    auto time_step = env.reset(42, std::unordered_map&lt;std::string, std::any&gt;());</div>
<div class="line"> </div>
<div class="line">    std::cout&lt;&lt;&quot;Reward on reset: &quot;&lt;&lt;time_step.reward()&lt;&lt;std::endl;</div>
<div class="line">    std::cout&lt;&lt;&quot;Observation on reset: &quot;&lt;&lt;time_step.observation()&lt;&lt;std::endl;</div>
<div class="line">    std::cout&lt;&lt;&quot;Is terminal state: &quot;&lt;&lt;time_step.done()&lt;&lt;std::endl;</div>
<div class="line"> </div>
<div class="line">    //...print the time_step</div>
<div class="line">    std::cout&lt;&lt;time_step&lt;&lt;std::endl;</div>
<div class="line"> </div>
<div class="line">    // take an action in the environment</div>
<div class="line">    // 2 = RIGHT</div>
<div class="line">    auto new_time_step = env.step(2);</div>
<div class="line"> </div>
<div class="line">    std::cout&lt;&lt;new_time_step&lt;&lt;std::endl;</div>
<div class="line"> </div>
<div class="line">    // get the dynamics of the environment for the given state and action</div>
<div class="line">    auto state = 0;</div>
<div class="line">    auto action = 1;</div>
<div class="line">    auto dynamics = env.p(state, action);</div>
<div class="line"> </div>
<div class="line">    std::cout&lt;&lt;&quot;Dynamics for state=&quot;&lt;&lt;state&lt;&lt;&quot; and action=&quot;&lt;&lt;action&lt;&lt;std::endl;</div>
<div class="line"> </div>
<div class="line">    for(auto item:dynamics){</div>
<div class="line"> </div>
<div class="line">        std::cout&lt;&lt;std::get&lt;0&gt;(item)&lt;&lt;std::endl;</div>
<div class="line">        std::cout&lt;&lt;std::get&lt;1&gt;(item)&lt;&lt;std::endl;</div>
<div class="line">        std::cout&lt;&lt;std::get&lt;2&gt;(item)&lt;&lt;std::endl;</div>
<div class="line">        std::cout&lt;&lt;std::get&lt;3&gt;(item)&lt;&lt;std::endl;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    action = env.sample_action();</div>
<div class="line">    new_time_step = env.step(action);</div>
<div class="line"> </div>
<div class="line">    std::cout&lt;&lt;new_time_step&lt;&lt;std::endl;</div>
<div class="line">    </div>
<div class="line">    // synchronize the environment</div>
<div class="line">    env.sync(std::unordered_map&lt;std::string, std::any&gt;());</div>
<div class="line">    </div>
<div class="line">    auto copy_env = env.make_copy(1);</div>
<div class="line">    copy_env.reset();</div>
<div class="line">    </div>
<div class="line">    std::cout&lt;&lt;&quot;Org env cidx: &quot;&lt;&lt;env.cidx()&lt;&lt;std::endl;</div>
<div class="line">    std::cout&lt;&lt;&quot;Copy env cidx: &quot;&lt;&lt;copy_env.cidx()&lt;&lt;std::endl;</div>
<div class="line">    </div>
<div class="line">    copy_env.close();</div>
<div class="line"> </div>
<div class="line">    // close the environment</div>
<div class="line">    env.close();</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">int main(){</div>
<div class="line"> </div>
<div class="line">    using namespace example_1;</div>
<div class="line">    </div>
<div class="line">    RESTApiServerWrapper server(SERVER_URL, true);</div>
<div class="line"> </div>
<div class="line">    std::cout&lt;&lt;&quot;Testing FrozenLake...&quot;&lt;&lt;std::endl;</div>
<div class="line">    example_1::test_frozen_lake(server);</div>
<div class="line">    std::cout&lt;&lt;&quot;====================&quot;&lt;&lt;std::endl;</div>
<div class="line">    return 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In general, the environments exposed by the library follow the semantics in <a href="https://github.com/deepmind/dm_env/blob/master/docs/index.md">Environment API and Semantics</a> specification. For more details see the <a href="doc/env_spec.md"><code>rlenvscpp</code> environment specification</a> document.</p>
<p>The general use case is to build the library and link it with your driver code to access its functionality. The environments specified as using REST in the tables above, that is all <code>Gymnasium</code>, <code>gym_pybullet_drones</code> and <code>GymWalk</code> environments are accessed via a client/server pattern. Namely, they are exposed via an API developed using <a href="https://fastapi.tiangolo.com/">FastAPI</a>. You need to fire up the FastAPI server, see dependencies, before using the environments in your code. To do so</p>
<div class="fragment"><div class="line">./start_uvicorn.sh</div>
</div><!-- fragment --><p>By default the <code>uvicorn</code> server listents on port 8001. Change this if needed. You can access the OpenAPI specification at</p>
<div class="fragment"><div class="line">http://0.0.0.0:8001/docs</div>
</div><!-- fragment --><p>Note that currently the implementation is not thread/process safe i.e. if multiple threads/processes access the environment a global instance of the environment is manipulated. Thus no session based environment exists. However, you can create copies of the same environment and access this via its dedicate index. If just one thread/process touches this specific environment you should be ok. Notice that the FastAPI server only uses a single process to manage all the environments. In addition, if you need multiple instances of the same environment you can also use one of the exissting vectorised environments (see table above).</p>
<p>Finally, you can choose to launch several instances of <code>uvirocrn</code> (listening on different ports). However in this case you need to implement all the interactions logic yourself as currently no implementation exists to handle such a scenario.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Dynamics</h2>
<p>Apart from the exposed environments, <code>rlenvscpp</code> exposes classes that describe the dynamics of some popular rigid bodies:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Dynamics   </th><th class="markdownTableHeadCenter">Example    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Differential drive   </td><td class="markdownTableBodyCenter"><a href="examples/example_9/example_9.cpp">example_9</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Quadrotor   </td><td class="markdownTableBodyCenter"><a href="examples/example_10/example_10.cpp">example_10</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Bicycle vehicle   </td><td class="markdownTableBodyCenter">TODO   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md2"></a>
Miscellaneous</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Item   </th><th class="markdownTableHeadCenter">Example    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Environment trajectory   </td><td class="markdownTableBodyCenter"><a href="examples/example_3/example_3.cpp">example_3</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">WaypointTrajectory   </td><td class="markdownTableBodyCenter"><a href="examples/example_11/example_11.cpp">example_11</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">TensorboardServer   </td><td class="markdownTableBodyCenter"><a href="examples/example_12/example_12.cpp">example_12</a>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md3"></a>
Dependencies</h2>
<p>The library has the following general dependencies</p>
<ul>
<li>A compiler that supports C++20 e.g. g++-11</li>
<li><a href="https://www.boost.org/">Boost C++</a></li>
<li><a href="https://cmake.org/">CMake</a> &gt;= 3.10</li>
<li><a href="https://github.com/google/googletest">Gtest</a> (if configured with tests)</li>
<li><a href="https://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen3</a></li>
</ul>
<p>Using the Gymnasium environments requires <a href="https://github.com/Farama-Foundation/Gymnasium/tree/main">Gymnasium</a> installed on your machine. In addition, you need to install</p>
<ul>
<li><a href="https://fastapi.tiangolo.com/">FastAPI</a></li>
<li><a href="https://www.uvicorn.org/">Uvicorn</a></li>
<li><a href="https://docs.pydantic.dev/latest/">Pydantic</a></li>
</ul>
<p>By installing the requirement under <code>requirements.txt</code> should set your Python environment up correctly.</p>
<p>In addition, the library also incorporates, see <code>(src/extern)</code>, the following libraries</p>
<ul>
<li><a href="https://github.com/elnormous/HTTPRequest">HTTPRequest</a></li>
<li><a href="https://github.com/nlohmann/json">nlohmann/json</a></li>
</ul>
<p>There are extra dependencies if you want to generate the documentation. Namely,</p>
<ul>
<li>Doxygen</li>
<li>Sphinx</li>
<li>sphinx_rtd_theme</li>
<li>breathe</li>
<li>m2r2</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
Installation</h2>
<p>The usual CMake based installation process is used. Namely</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build &amp;&amp; cmake ..</div>
<div class="line">make install</div>
</div><!-- fragment --><p>You can toggle the following variables</p>
<ul>
<li>CMAKE_BUILD_TYPE (default is RELEASE)</li>
<li>ENABLE_TESTS_FLAG (default is OFF)</li>
<li>ENABLE_EXAMPLES_FLAG (default is OFF)</li>
<li>ENABLE_DOC_FLAG (default is OFF)</li>
</ul>
<p>For example enbling the examples</p>
<div class="fragment"><div class="line">cmake -DENABLE_EXAMPLES_FLAG=ON ..</div>
<div class="line">make install</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md5"></a>
Run the tests</h3>
<p>You can execute all the tests by running the helper script <code>execute_tests.sh</code>.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
Issues</h3>
<h4><a class="anchor" id="autotoc_md7"></a>
Could not find &lt;tt&gt;boost_system&lt;/tt&gt;</h4>
<p>It is likely that you are missing the boost_system library with your local Boost installation. This may be the case is you installed boost via a package manager. On a Ubuntu machine the following should resolve the issue</p>
<div class="fragment"><div class="line">sudo apt-get update -y</div>
<div class="line">sudo apt-get install -y libboost-system-dev</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md8"></a>
FastAPI throws 422 Unpocessable entity</h4>
<p>Typically, this is a problem with how the client (400-range error) specified the data to be sent to the server. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
